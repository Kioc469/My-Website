<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS Vulnerability Lab - PenTest Practice</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .vuln-section {
            border: 2px solid #ff6b6b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            background: #ffe6e6;
        }
        .warning {
            background: #ff4757;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background: #ff6b6b;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #ff5252;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #ff6b6b;
            min-height: 20px;
        }
        .code {
            background: #2d3748;
            color: #68d391;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîì XSS Vulnerability Testing Lab</h1>
        <div class="warning">
            ‚ö†Ô∏è INTENTIONALLY VULNERABLE - FOR EDUCATIONAL PURPOSES ONLY ‚ö†Ô∏è
        </div>
        
        <p><strong>Purpose:</strong> Practice identifying and exploiting Cross-Site Scripting (XSS) vulnerabilities.</p>
        <p><strong>Your Mission:</strong> Find ways to execute JavaScript code through the input fields below.</p>

        <!-- Vulnerability 1: Reflected XSS -->
        <div class="vuln-section">
            <h3>üéØ Challenge 1: Reflected XSS</h3>
            <p><strong>Scenario:</strong> Search functionality that reflects user input without sanitization.</p>
            <form onsubmit="return reflectedXSS()">
                <input type="text" id="searchInput" placeholder="Search for something..." required>
                <button type="submit">Search</button>
            </form>
            <div class="code">
                Try: &lt;script&gt;alert('XSS')&lt;/script&gt;<br>
                Try: &lt;img src=x onerror=alert('XSS')&gt;<br>
                Try: &lt;svg onload=alert('XSS')&gt;
            </div>
            <div id="searchResult" class="result"></div>
        </div>

        <!-- Vulnerability 2: Stored XSS Simulation -->
        <div class="vuln-section">
            <h3>üéØ Challenge 2: Stored XSS (Simulated)</h3>
            <p><strong>Scenario:</strong> Comment system that stores and displays user input.</p>
            <textarea id="commentInput" placeholder="Leave a comment..." rows="3"></textarea>
            <button onclick="addComment()">Post Comment</button>
            <div class="code">
                Try: &lt;script&gt;alert('Stored XSS')&lt;/script&gt;<br>
                Try: &lt;iframe src=javascript:alert('XSS')&gt;&lt;/iframe&gt;<br>
                Try: &lt;body onload=alert('XSS')&gt;
            </div>
            <div id="comments" class="result">
                <h4>Comments:</h4>
            </div>
        </div>

        <!-- Vulnerability 3: DOM-based XSS -->
        <div class="vuln-section">
            <h3>üéØ Challenge 3: DOM-based XSS</h3>
            <p><strong>Scenario:</strong> URL parameter directly inserted into DOM.</p>
            <button onclick="processUrlParam()">Process URL Parameter 'msg'</button>
            <div class="code">
                Try adding to URL: ?msg=&lt;script&gt;alert('DOM XSS')&lt;/script&gt;<br>
                Try: ?msg=&lt;img src=x onerror=alert('DOM')&gt;<br>
                Current URL: <span id="currentUrl"></span>
            </div>
            <div id="urlResult" class="result"></div>
        </div>

        <!-- Vulnerability 4: innerHTML XSS -->
        <div class="vuln-section">
            <h3>üéØ Challenge 4: innerHTML Injection</h3>
            <p><strong>Scenario:</strong> Dynamic content generation using innerHTML.</p>
            <input type="text" id="nameInput" placeholder="Enter your name">
            <button onclick="greetUser()">Generate Greeting</button>
            <div class="code">
                Try: &lt;img src=x onerror=alert('innerHTML XSS')&gt;<br>
                Try: &lt;svg/onload=alert('XSS')&gt;<br>
                Try: &lt;details open ontoggle=alert('XSS')&gt;
            </div>
            <div id="greeting" class="result"></div>
        </div>

        <!-- Challenge Hints -->
        <div class="container">
            <h3>üõ†Ô∏è Pentesting Tips</h3>
            <ul>
                <li><strong>Burp Suite:</strong> Intercept requests to modify payloads</li>
                <li><strong>Browser DevTools:</strong> Inspect DOM changes and console errors</li>
                <li><strong>Payload Variations:</strong> Try different encoding (URL, HTML entities)</li>
                <li><strong>Bypass Filters:</strong> If blocked, try alternative tags and events</li>
                <li><strong>Context Analysis:</strong> Understand where your input lands in the page</li>
            </ul>
        </div>

        <div class="container">
            <h3>üìö Learning Objectives</h3>
            <ul>
                <li>Identify different types of XSS vulnerabilities</li>
                <li>Practice payload crafting and filter bypass</li>
                <li>Understand the impact of XSS attacks</li>
                <li>Learn to think like an attacker</li>
            </ul>
        </div>
    </div>

    <script>
        // Display current URL for DOM XSS testing
        document.getElementById('currentUrl').textContent = window.location.href;

        // Vulnerability 1: Reflected XSS
        function reflectedXSS() {
            const input = document.getElementById('searchInput').value;
            const result = document.getElementById('searchResult');
            
            // INTENTIONALLY VULNERABLE: Direct insertion without sanitization
            result.innerHTML = `<h4>Search Results for: ${input}</h4><p>No results found for "${input}"</p>`;
            
            return false; // Prevent form submission
        }

        // Vulnerability 2: Stored XSS (simulated with localStorage)
        function addComment() {
            const input = document.getElementById('commentInput').value;
            if (!input.trim()) return;
            
            // Store comment in localStorage (simulating database storage)
            let comments = JSON.parse(localStorage.getItem('comments') || '[]');
            comments.push({
                text: input,
                timestamp: new Date().toLocaleString()
            });
            localStorage.setItem('comments', JSON.stringify(comments));
            
            // Clear input and refresh comments
            document.getElementById('commentInput').value = '';
            displayComments();
        }

        function displayComments() {
            const comments = JSON.parse(localStorage.getItem('comments') || '[]');
            const container = document.getElementById('comments');
            
            let html = '<h4>Comments:</h4>';
            comments.forEach((comment, index) => {
                // INTENTIONALLY VULNERABLE: Direct insertion of user content
                html += `
                    <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 4px;">
                        <div>${comment.text}</div>
                        <small style="color: #666;">${comment.timestamp}</small>
                        <button onclick="deleteComment(${index})" style="float: right; font-size: 12px;">Delete</button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function deleteComment(index) {
            let comments = JSON.parse(localStorage.getItem('comments') || '[]');
            comments.splice(index, 1);
            localStorage.setItem('comments', JSON.stringify(comments));
            displayComments();
        }

        // Vulnerability 3: DOM-based XSS
        function processUrlParam() {
            const urlParams = new URLSearchParams(window.location.search);
            const msg = urlParams.get('msg');
            const result = document.getElementById('urlResult');
            
            if (msg) {
                // INTENTIONALLY VULNERABLE: Direct DOM insertion
                result.innerHTML = `<h4>Message from URL:</h4><p>${msg}</p>`;
            } else {
                result.innerHTML = '<p>No "msg" parameter found in URL. Add ?msg=your_message to the URL.</p>';
            }
        }

        // Vulnerability 4: innerHTML XSS
        function greetUser() {
            const name = document.getElementById('nameInput').value;
            const greeting = document.getElementById('greeting');
            
            if (name.trim()) {
                // INTENTIONALLY VULNERABLE: innerHTML with user input
                greeting.innerHTML = `<h4>Hello, ${name}!</h4><p>Welcome to our vulnerable application!</p>`;
            } else {
                greeting.innerHTML = '<p>Please enter a name.</p>';
            }
        }

        // Load stored comments on page load
        window.onload = function() {
            displayComments();
            processUrlParam(); // Check for URL parameters on load
        };

        // Additional vulnerable function for advanced testing
        function executeUserCode(code) {
            // EXTREMELY VULNERABLE: Never do this in real applications!
            try {
                eval(code);
            } catch (e) {
                console.log('Error executing code:', e);
            }
        }

        // Console message for pentesters
        console.log('%cüîì PENTESTING LAB LOADED', 'color: red; font-size: 16px; font-weight: bold;');
        console.log('Try these console commands:');
        console.log('executeUserCode("alert(\'Console XSS\')")');
        console.log('document.getElementById("searchResult").innerHTML = "<img src=x onerror=alert(\'Direct DOM manipulation\')>"');
    </script>
</body>
</html>
